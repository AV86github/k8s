# Проект

Проект сделан на baremetal kubernetes, развернутом в домешней сети.

## Инфтраструктура
Виртуальные машины для кластера и дополнительных сервисов разворачиваются в ProxMox 
на основе заранее подготовленных шаблонов на основе RockyLinux.

Вне проектной работы развернуты следующие сервисы:

- кластер k8s (infra) для инфраструктурных сервисов
- minio (в infra кластере k8s)
- harbor (в infra кластере k8s)
- DNS сервер bind9
- GitLab
- GitLab runner

Сетевая схема (сеть 192.168.31.0/24):

- 200  - DNS, gitlabrunner
- 40   - NFS
- 231  - k8s master1
- 232  - k8s worker1
- 233  - k8s worker2

## Bootstrap кластера

Для бутстрапа кластера используется GitLab pipeline. \
Кластер создается с использованием kubespray. 

Глобальные переменные:  
- SSH_KEY - ssh ключ. есть во всех VM (добавлен в шаблон)
- CLUSTER_CONFIG - конфиг k8s. \

Переменные пайпа:    

- CLUSTER_BOOTSTRAP - 
- IP
- sizing


## CICD приложения
В качестве примера приложения используется [Amazon aks store](https://github.com/Azure-Samples/aks-store-demo)

Сборка и деплой приложения настроены только для 1 сервиса. Остальные используются из примера.


## Допущения

- переменная *CLUSTER_CONFIG* в гитлабе задается после создания кластера.
- если приложение деплоится через ArgoApplication и values задается внутри application, то для обновления нужно руками править через UI.
- 